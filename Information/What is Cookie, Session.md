# What is Cookie, Session

## Cookie?

우리는 HTTP 프로토콜을 이용하여 통신을 합니다. HTTP는 비연결성, 비상태성의 특징이 있습니다. 즉, 사용자의 요청마다 연결과 해제과정을 하기 때문에 정보가 저장이 되지 않습니다. 이를 해결하기 위해 나온 것이 쿠키입니다.

웹사이트에 방문할 때 서버(Server)에 의해 사용자 컴퓨터(Client)에 저장되는 정보를 쿠키라 불린다.

웹사이트는 쿠키를 통해 접속자의 장치를 인식하고 접속자의 설정과 과거 이용내역에 대한 일부데이터를 저장합니다.

이렇게 저장된 쿠키는 사용자의 요청이 있을 때 쿠키를 서버에 같이 보내서 서버가 사용자을 식별할 수 있게 해줍니다.

<br>

### 쿠키의 통신과정

![]()

<br>

(1) Request : 클라이언트가 서버에게 정보를 요청

(2) Response : 서버가 클라이언트에 쿠키 전달, 클라이언트는 쿠키를 자체적으로 저장한다.

(3) Request with Cookie : 이후 재통신할 경우 쿠키와 함께 정보를 요청한다.

(4) Response with Cookie : 쿠키 값에 따른 정보를 보여준다.

<br>

### 쿠키의 사용목적

- 세션관리 : 로그인, 사용자 정보, 접속 시간 등 서버가 알아야 할 정보들을 저장합니다.
- 개인화 : 사용자마다 각각 다른 페이지를 보여줍니다.
- 트래킹 : 사용자 행동과 패턴을 분석합니다.

<br>

### 쿠키의 사용예시

쿠키가 있기 때문에 로그인한 상태에서 여러 페이지를 이동하며 다닐수 있습니다.

- ID저장, 로그인 유지
- 쇼핑몰 장바구니
- 최근 검색 기록

<br>

### 쿠키의 특징

- 쿠키는 클라이언트에 저장되며, Key와 Value로 이루어진 데이터이다.
- HTTP Response Header 넣어 클라이언트에 전달됩니다.
- Set-Cookie, 속성(Flag)을 가질 수 있습니다.

<br>

### 쿠키의 단점

- 웹사이트에 대한 정보 및 개인 정보가 담겨 있어 사생황 침해의 소지가 있습니다. 
- 쿠키 거부 시 정상적인 웹사이트 이용이 불가능 할 수도 있습니다.
- 사용자가 가지고 있기 때문에 보안에 취약합니다.

<br>

### Cookie Flags?

#### path

URL 값으로 값에 따른 특정 경로에서만 쿠키를 활성화 시키는 속성입니다. 그 경로 혹은 하위 경로에서만 접근이 가능합니다.

```
path = /user

>>>
/user 혹은 /user/1, /user/test 경로에서만 접근이 가능합니다.
```

<br>

#### domain

쿠키에 접근 가능한 도메인을 설정합니다. 아무 값도 넣지 않았다면 서브 도메인에서는 접근이 불가능하고 그 도메인에서만 접근이 가능합니다.

도메인을 설정한 경우 그 서브 도메인에서도 접근이 가능합니다

```
접속된 웹사이트 = naver.com

domain = (설정하지 않음)

>>>
naver.com 만 접근 가능

domain = naver.com

*.naver.com 접근 가능
pay.naver.com, blog.naver.com
```

<br>

#### expires

쿠키의 만료기간을 의미하면 만료기간이 지나면 삭제됩니다.

아무것도 입력하지 않으면 사라지지 않습니다. 단, 직접삭제하는 경우 제외

0 입력 시 바로삭제됩니다.

<br>

#### secure

HTTPS 통신아닌 경우 쿠키를 전송하지 않습니다.

HTTP 통신에서는 전달이 불가능합니다.

외부의 공격자로 부터 쿠키를 보호할 수 있습니다.

<br>

#### httpOnly

자바스크립트로 document.cookie에 접근이 불가능합니다.

XSS로 쿠키 탈취 공격을 막기위한 방법 중 하나이다.

<br>

## Session?

쿠키의 단점으로 보안하기 위해 나왔습니다. 세션은 쿠키를 기반으로 하고 있지만 사용자가 아닌 서버 측에서 관리합니다.

아이디, 닉네임 등의 정보를 세션에 담아두면 DB에 접근할 필요가 없어 효율적입니다.

### 세션의 특징

서버에서는 사용자를 구분하기 위해 세션 ID를 부여하여 브라우저 종료시 까지 인증상태를 유지합니다. 세션 만료 시간을 정해주면 일정 시간 뒤 자동으로 세션이 만료됩니다.

세션 ID에 따라 사용자에 맞는 정보를 제공합니다.

데이터를 서버에 두기 때문에 쿠키보다는 보안이 좋습니다.

하지만 서버에 데이터를 두기 때문에 메모리를 많이 차지할 수 도 있고 속도도 느립니다.

로그인 같이 보안에 중요한 기능에 이용합니다.

<br>

## Reference

https://pygmalion0220.tistory.com/entry/HTTP-Cookie-%EA%B8%B0%EB%B3%B8-%EA%B0%9C%EB%85%90

https://jsonobject.tistory.com/511

https://devuna.tistory.com/23

https://velog.io/@y1andyu/%EC%BF%A0%ED%82%A4-%EC%86%8D%EC%84%B1%EB%93%A4